{## Start with  defaults from defaults.yaml ##}
{% import_yaml "dovecot/defaults.yml" as default_settings %}

{% set os_family_map = salt['grains.filter_by']({
    'Debian': {
        'config': {
            'ext': ['ldap', 'sql'],
            'filename': 'local',
            'local': '# no customization',
            'dovecotext': {},
            'confext': {},
            'conf': {},
            'ssl_certs': {},
            'ssl_keys': {},
            'ssl_certs_dir': '/etc/ssl/private',
            'ssl_keys_dir': '/etc/ssl/private',
           },
        'packages': ['dovecot-core','dovecot-imapd'],
    },
    'Gentoo': {
        'config': {
            'ext': ['ldap', 'sql'],
            'filename': 'local',
            'local': '# no customization',
            'dovecotext': {},
            'confext': {},
            'conf': {},
            'ssl_certs': {},
            'ssl_keys': {},
            'ssl_certs_dir': '/etc/ssl/private',
            'ssl_keys_dir': '/etc/ssl/private',
           },
        'packages': ['net-mail/dovecot'],
    },
    'Arch': {
        'config': {
            'ext': ['ldap', 'sql'],
            'filename': 'dovecot',
            'local': '# no customization',
            'dovecotext': {},
            'confext': {},
            'conf': {},
            'ssl_certs': {},            
            'ssl_keys': {},
            'ssl_certs_dir': '/etc/ssl/private',
            'ssl_keys_dir': '/etc/ssl/private',
            },
        'packages': ['dovecot'],
    },
    'RedHat': {
        'config': {
            'ext': ['ldap', 'sql'],
            'filename': 'local',
            'local': '# no customization',
            'dovecotext': {},
            'confext': {},
            'conf': {},
            'ssl_certs': {},
            'ssl_keys': {},
            'ssl_certs_dir': '/etc/pki/dovecot/certs',
            'ssl_keys_dir': '/etc/pki/dovecot/private',
            },
         'packages': ['dovecot','dovecot-pigeonhole'],
    },
}, merge=salt['pillar.get']('dovecot:lookup')) %}

{## Merge the flavor_map to the default settings ##}
{% do default_settings.dovecot.update(os_family_map) %}

{## Merge in dovecot pillar ##}
{% set dovecot_settings = salt['pillar.get'](
   'dovecot',
    default=default_settings.dovecot,
    merge=True) 
%}
